<html>
  <head>
    <title>Verifying connection</title>
    <script src="{{ .FrontendJS }}" async defer referrerpolicy="no-referrer"></script>
  </head>
  <body>
    <h1>Verifying connection</h1>
    <p>One moment while we verify your network connection.</p>
    <form action="{{ .ChallengeURL }}" method="post" id="captcha-form" accept-charset="UTF-8">
        <div
            data-callback="captchaCallback"
            class="{{ .FrontendKey }}"
            data-sitekey="{{ .SiteKey }}"
            data-theme="auto"
            data-size="normal"
            data-language="auto"
            data-retry="auto"
            interval="8000"
            data-appearance="always"
            {{- if .Challenge }}
            data-challenge="{{ .Challenge }}"
            {{- end }}
            {{- if .Difficulty }}
            data-difficulty="{{ .Difficulty }}"
            {{- end }}
        ></div>
        <input type="hidden" name="destination" value="{{ .Destination }}">
    </form>
    <script type="text/javascript">
        function captchaCallback(token) {
            var form = document.getElementById("captcha-form");
            var captchaDiv = document.querySelector('[data-callback]');
            var frontendKey = captchaDiv.className;

            // Create hidden input for the token if it doesn't exist
            var inputName = frontendKey + "-response";
            var existingInput = form.querySelector('input[name="' + inputName + '"]');
            if (!existingInput) {
                var input = document.createElement("input");
                input.type = "hidden";
                input.name = inputName;
                input.value = token;
                form.appendChild(input);
            } else {
                existingInput.value = token;
            }

            setTimeout(function() {
                form.submit();
            }, 1000);
        }
    </script>
  </body>
</html>
